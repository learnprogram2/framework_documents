#### 分布式 ∈ 微服务: 微服务一定是分布式的, 分布式组成生态叫做微服务.

- 分布式: 更倾向于不同的机器之间的RPC调用
- 微服务: 不同的有机服务. 



## ribbon 大体介绍

### 041. 分布式系统中的负载均衡作用

ribbon是Netflix公司的, 用于调用时的负载均衡. load balance.

![041_ribbon负责负载均衡](2. Ribbon.assets/041_ribbon负责负载均衡.png)



### 042. ribbon实现负载均衡demo

1. 弄两个接口
2. 调用, 查看负载均衡效果



### 043. ribbon 原生接口 和 内置规则

1. ILoadBalancer: 维护一个server list
2. IRule: 根据balancer的list, 选择一个url.

- 默认的负载均衡: roundRobinRule 轮询, AvaliabilityFilterRule: 考察服务器可用性的, 越失败连接间隔越长. WeightedResponseTimeRule: 带权重的服务器. BestAvailableRule: 尽量连接并发低的服务器. 



### 044. IPing定时ping服务器判断是否存活

```java
balancer.setPing(new PingUrl());
balancer.setPingInterval(1);
// IPing接口负责定时ping服务器, 判断是否存活.
public interface IPing {
    /**
     * 暴露isAlive接口
     */
    public boolean isAlive(Server server);
}
```



ribbon重要组件: RestClient, ILoadBalancer、IRule、IPing





### 045. Spring-cloud中ribbon的使用, 图解工作原理



```java
// 融入ribbon到RestTemplate里面. 
@LoadBalance
@Bean
public RestTemplate getRestTemplate() {
  return new RestTemplate();
}
// 2. 使用restTemplate访问, 就是HTTP请求组件
//		restTemplate从ribbon哪里拿到服务地址.
```

![image-20210107224754797](2. Ribbon.assets/image-20210107224754797.png)





### 046. ribbon大体流程图

![image-20210107230742074](2. Ribbon.assets/image-20210107230742074.png)



## ribbon 源码初探



### 047. @LoadBalanced作为入口

1. 找到`@LoadBalanced`的包, 然后看一下自动装配的其他东西
2. 找到`LoadBalancerAutoConfiguration` 和`AsyncLoadBalancerAutoConfiguration` 

































